<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Century Gothic";
	panose-1:2 11 5 2 2 2 2 2 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:0cm;
	line-height:105%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-right:0cm;
	margin-left:0cm;
	font-size:18.0pt;
	font-family:"Times New Roman",serif;
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p
	{margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
address
	{mso-style-link:"HTML Address Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;
	font-style:italic;}
pre
	{mso-style-link:"HTML Preformatted Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:36.0pt;
	line-height:105%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:105%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:105%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:36.0pt;
	line-height:105%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
span.HTMLAddressChar
	{mso-style-name:"HTML Address Char";
	mso-style-link:"HTML Address";
	font-family:"Times New Roman",serif;
	font-style:italic;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Times New Roman",serif;
	font-weight:bold;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-link:"HTML Preformatted";
	font-family:"Courier New";}
p.msonormal0, li.msonormal0, div.msonormal0
	{mso-style-name:msonormal;
	margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
p.msochpdefault, li.msochpdefault, div.msochpdefault
	{mso-style-name:msochpdefault;
	margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.msopapdefault, li.msopapdefault, div.msopapdefault
	{mso-style-name:msopapdefault;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:0cm;
	line-height:105%;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
span.code-comment
	{mso-style-name:code-comment;}
span.code-keyword
	{mso-style-name:code-keyword;}
span.code-digit
	{mso-style-name:code-digit;}
span.code-string
	{mso-style-name:code-string;}
span.hljs-keyword
	{mso-style-name:hljs-keyword;}
span.hljs-string
	{mso-style-name:hljs-string;}
span.crayon-k
	{mso-style-name:crayon-k;}
span.crayon-h
	{mso-style-name:crayon-h;}
span.crayon-i
	{mso-style-name:crayon-i;}
span.crayon-sy
	{mso-style-name:crayon-sy;}
span.crayon-o
	{mso-style-name:crayon-o;}
span.crayon-s
	{mso-style-name:crayon-s;}
.MsoChpDefault
	{font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:105%;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 72.0pt 72.0pt 72.0pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=EN-GB link=blue vlink="#954F72">

<div class=WordSection1>

<p class=MsoNormal><b><span style='font-size:12.0pt;line-height:105%;
font-family:"Century Gothic",sans-serif'>Index and Statistics Maintenance</span></b></p>

<p class=MsoNoSpacing>Indexes need to be rebuilt when the fragmentation levels
reach a certain point. Fragmentation occurs as a result of normal database use,
i.e. INSERT, UPDATE and DELETE functions. If the fragmentation is still below
an acceptable level it is recommended to perform index reorganizations, which
cleans up the indexes.</p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;
color:black'>After indexes are created, they will undergo automatic maintenance
by the SQL Server Database Engine whenever insert, update or delete operations
are executed on the underlying data.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Even
so, these automatic modifications will continuously scatter the information in
the index throughout the database - fragmenting the index over time. The result
- indexes now have pages where logical ordering (based on the key value)
differs from the physical ordering inside the data file. This means that there
is a high percentage of free space on the index pages, and that SQL Server has
to read higher number of pages when scanning each index. Also, ordering of
pages that belong to the same index gets scrambled and this adds more work to
the SQL Server when reading an index - especially in IO terms.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>The
Index fragmentation impact on the SQL Server can range from decreased
efficiency of queries - for servers with low performance impact, all the way to
the point where SQL Server completely stops using indexes and resorts to the
last-straw solution full table scans for each and every query. As mentioned
before, full table scans will drastically impact SQL Server performance and
this is final alarm to remedy index fragmentation on the SQL Server.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>The
solution to fragmented indexes is to rebuild or reorganize indexes.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>But,
before considering maintenance of indexes, it is important to answer two main
questions:</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>1.
What is the degree of fragmentation?</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>2.
What is the appropriate action? Reorganize or rebuild?</span></p>

<h2 style='margin-top:11.25pt;margin-right:0cm;margin-bottom:11.25pt;
margin-left:0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Detecting
fragmentation</span></h2>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Generally,
in order to solve any problem, it is essential to first and foremost locate it,
and isolate affected area before applying the correct remedy.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Fragmentation
can be easily detected by running the system function&nbsp;<a
href="https://msdn.microsoft.com/en-us/library/ms188917.aspx" target="_blank"
style='box-sizing: border-box;outline: none'><span style='color:#337AB7'>sys.dm_db_index_physical_stats</span></a>
which returns the size and the fragmentation information for the data and
indexes of tables or views in SQL Server. It can be run only against a specific
index in the table or view, all indexes in the specific table or view, or vs.
all indexes in all databases:</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><img border=0 width=1260 height=267 id="Picture 3"
src="IndexAndStatisticsMaintenance_files/image001.jpg"></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>The
results returned after running the procedures include following information:</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:38.25pt;text-indent:-20.25pt;
line-height:normal;background:white'><span style='font-size:10.0pt;font-family:
Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='color:black'>avg_fragmentation_in_percent - average
percent of incorrect pages in the index</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:38.25pt;text-indent:
-20.25pt;line-height:normal;background:white'><span style='font-size:10.0pt;
font-family:Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='color:black'>fragment_count - number of fragments in
index</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:38.25pt;text-indent:-20.25pt;
line-height:normal;background:white'><span style='font-size:10.0pt;font-family:
Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='color:black'>avg_fragment_size_in_pages - average
number of pages in one fragment in an index</span></p>

<h2 style='margin-top:11.25pt;margin-right:0cm;margin-bottom:11.25pt;
margin-left:0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Analyzing
detection results</span></h2>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>After
the fragmentation has been detected, the next step is to determine its impact
on the SQL Server and if any course of action needs to be taken.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>There
is no exact information on the minimal amount of fragmentation that affects the
SQL Server in specific way to cause performance congestion, especially since
the SQL Server environments greatly vary from one system to another.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>However,
there is a generally accepted solution based on the percent of fragmentation
(avg_fragmentation_in_percent column from the previously described
sys.dm_db_index_physical_stats function)</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:38.25pt;text-indent:-20.25pt;
line-height:normal;background:white'><span style='font-size:10.0pt;font-family:
Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong><span style='font-family:"Calibri",sans-serif;color:black'>Fragmentation
is less than 10% - </span></strong><span style='color:black'>no
de-fragmentation is required. It is generally accepted that in majority of
environments index fragmentation less than 10% in negligible and its
performance impact on the SQL Server is minimal.</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:38.25pt;text-indent:
-20.25pt;line-height:normal;background:white'><span style='font-size:10.0pt;
font-family:Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong><span style='font-family:"Calibri",sans-serif;color:black'>Fragmentation
is between 10-30% - </span></strong><span style='color:black'>it is suggested
to perform index reorganization</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:38.25pt;text-indent:-20.25pt;
line-height:normal;background:white'><span style='font-size:10.0pt;font-family:
Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong><span style='font-family:"Calibri",sans-serif;color:black'>Fragmentation
is higher than 30%</span></strong><span style='color:black'> - it is suggested
to perform index rebuild</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Here
is the reasoning behind the thresholds above which will help you to determine
if you should perform index rebuild or index reorganization:</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Index
reorganization is a process where the SQL Server goes through existing index,
and cleans it up. Index rebuild is a heavy-duty process where index is deleted
and then recreated from scratch with entirely new structure, free from all
piled up fragments and empty-space pages.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>While
index reorganization is a pure cleanup operation which leaves system state as
it is without locking-out affected tables and views, the rebuild process locks
affected table for the whole rebuild period, which may result in long
down-times that could not be acceptable in some environments.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>With
this in mind, it is clear that the index rebuild is a process with `stronger`
solution, but it comes with a price - possible long locks on affected indexed
tables.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>On
the other side, index reorganization is a `lightweight` process that will solve
the fragmentation in a less effective way - since cleaned index will always be
second to the new one fully made from scratch. But reorganizing index is much
better from the efficiency standpoint, since it does not lock affected indexed
table during the course of operation.</span></p>

<p style='margin-top:8.25pt;margin-right:0cm;margin-bottom:15.75pt;margin-left:
0cm;background:white;box-sizing: border-box;font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><span style='font-size:11.0pt;font-family:"Calibri",sans-serif;color:black'>Servers
with regular maintenance periods (e.g. regular maintenance over weekend) should
almost always opt for the index rebuild, regardless of the fragmentation
percent, since these environments will hardly be affected by the table
lock-outs imposed by index rebuilds due to regular and long maintenance
periods.</span></p>

<p class=MsoNoSpacing>An excellent <span style='font-size:9.0pt;font-family:
"Verdana",sans-serif;color:#333333;background:white'>SQL Server Maintenance
Solution</span> has been provided by Ola Hallengren. See <a
href="https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html">https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html</a></p>

<p class=MsoNoSpacing>&nbsp;</p>

<p class=MsoNoSpacing>&nbsp;</p>

<p class=MsoNormal><span style='color:#111111;background:white'><a
href="https://inteltext.github.io/index.html">Return to Index Page</a></span></p>

<p class=MsoNormal><b><span style='font-size:12.0pt;line-height:105%;
font-family:"Century Gothic",sans-serif'>&nbsp;</span></b></p>

</div>

</body>

</html>
